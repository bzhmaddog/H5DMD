<!DOCTYPE html>
<html>
    <head>
        <style>
            * {
	            box-sizing: border-box;
            }
            body {
                background:  black;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }

            /*#output {
                border: 1px solid red;
            }*/
        </style>
    </head>
    <body>
        <canvas id="output" width="1280" height="390"></canvas>
        <script type="module">
            import { DMD } from './js/DMD.mjs';
            import { Utils } from './js/Utils.mjs';
            import { Colors } from './js/Colors.mjs';
            import { CanvasLayer } from './js/CanvasLayer.mjs';

            (function () {
                'use strict';

                // When dom is loaded create the objects and bind the events
                document.addEventListener('DOMContentLoaded', function () {

                    var output = document.getElementById('output');


                    // 256x78
                    //var dmd = new DMD(output, 4, 1, 1, 1, DMD.DotShape.Square, 14, 1, true);

                    // 426x130
                    var dmd = new DMD(output, 2, 1, 1, 1, DMD.DotShape.Square, 14, 1, true);

                    // 320x97
                    //var dmd = new DMD(output, 2, 2, 1, 1, DMD.DotShape.Square, 14, 1, true);

                    // 128x39
                    //var dmd = new DMD(output, 7, 3, 1, 1, DMD.DotShape.Square, 14, 1, true);

                    			// Init DMD then
        			dmd.init().then( () => {
                        // Start rendering dmd
                        dmd.run();

                        dmd.createLayer(DMD.LayerType.Image, 'bg', {
                            src : 'images/boss-mode-bg.png',
                            //opacity : 0.1
                        });

                        dmd.createLayer(DMD.LayerType.Animation, 'animation', {
                            images : [
                                'images/animation/0.webp',
                                'images/animation/1.webp',
                                'images/animation/2.webp',
                                'images/animation/3.webp',
                                'images/animation/4.webp',
                                'images/animation/5.webp',
                                'images/animation/6.webp',
                                'images/animation/7.webp',
                                'images/animation/8.webp',
                                'images/animation/9.webp',
                                'images/animation/10.webp',
                                'images/animation/11.webp',
                                'images/animation/12.webp',
                                'images/animation/13.webp',
                                'images/animation/14.webp'
                            ],
                            duration : 800,
                            autoplay : true,
                            loop : true
                        });

                        var canvasLayer = dmd.createLayer(DMD.LayerType.Canvas, 'canvas', {}, function() {
                            var img = new Image();

		                    img.onload = function() {
                                // x,y coordinate are related to the screen width/height (not dmd width/height) to be consistant depending on the settings used
			                    canvasLayer.drawImage(
                                    img,
                                    {
                                        align: 'right',
                                        vAlign : 'middle',
                                        height : '70%'
                                    }
                                );
		                    }

                            img.src = 'images/boss-matthew-big.png';
                        });

                        var textLayer1 = dmd.createLayer(DMD.LayerType.Text, 'text1', {
                            'text' : "Scott Pilgrim",
                            left : '0',
                            top : 0,
                            fontSize : 10
                        });

                        var textLayer2 = dmd.createLayer(DMD.LayerType.Text, 'text2', {
                            'text' : "VS",
                            align : 'center',
                            vAlign : 'middle',
                            fontFamily : 'Arial',
                            fontSize : 40,
                            fontStyle : 'italic bold',
                            color : '#FFFFFF80', // RGBA
                            hOffset : '-60%'
                        });

                        var textLayer3 = dmd.createLayer(DMD.LayerType.Text, 'text3', {
                            'text' : "VS",
                            align : 'center',
                            vAlign : 'middle',
                            fontFamily : 'Arial',
                            fontSize : 40,
                            fontStyle : 'italic bold',
                            color : '#00000000', // totally transparent
                            strokeWidth : 2,
                            strokeColor : Colors.red,
                            hOffset : '-60%'
                        });

                        var textLayer4 = dmd.createLayer(DMD.LayerType.Text, 'text4', {
                            'text' : "Matthew Patel",
                            align : 'right',
                            vAlign : 'bottom',                            
                            fontSize : 10,
                            hOffset : -1
                        });

                        var spriteLayer = dmd.createLayer(DMD.LayerType.Sprites, 'sprite', {}, function() {
                            spriteLayer.createSprite(
                                'scott',
                                'images/scott.png',
                                3,
                                0,
                                [
                                    ['idle', 8, 36, 59, 0, 0, .16],
                                    ['walk', 6, 36, 63, 0, 59, .12],
                                    ['run', 8, 53, 60, 0, 122, .20],
                                    ['idle2', 4, 46, 62, 0, 182, .09],
                                    ['taunt', 9, 46, 62, 0, 244, .25]
                                ],
                                10,
                                60
                            ).then(() => {
                                let seq = [
                                            ['idle' , 3],
                                            ['walk' , 5],
                                            ['run', 4],
                                            ['taunt', 1]
                                        ];

                                spriteLayer.enqueueSequence('scott', seq, true);
                                spriteLayer.run('scott');
                            });
                        });                      
                        
                    });
                },false);
            })();
        </script>
    </body>
</html>